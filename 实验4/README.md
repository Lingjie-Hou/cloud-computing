### 实验4：Ceph的安装与实践 

#### 1.最小化安装四台虚拟机并添加到shell中（方便操作）：

![](../image/4.1.png)

![](../image/4.2.png)

#### 2.配置所有节点：

###### （1）为“ cephuser”配置sudo权限

![](../image/4.3.png)

###### （2）安装和配置NTP

![](../image/4.4.png)

![](../image/4.5.png)

###### （3）安装Open-vm-tools

![](../image/4.6.png)

###### （4）禁用SELinux

![](../image/4.7.png)

###### （5）配置主机文件

![](../image/4.8.png)

#### 3.配置SSH服务器:

###### (1)在主控节点上设置免密登录并生成ssh密钥

![](../image/4.9.png)

![](../image/4.10.png)

###### (2)为ssh配置创建配置文件

![](../image/4.11.png)

###### （3）使用ssh-copy-id命令将SSH密钥添加到所有节点

![](../image/4.12.png)

###### （4）分发密钥

![](../image/4.13.png)

###### (5)测试从ceph-admin访问各节点

![](../image/4.14.png)

#### 4.配置防火墙：

###### （1）ceph-admin节点防火墙

![](../image/4.15.png)

###### (2)mon1防火墙

![](../image/4.16.png)

###### （3）osd防火墙

![](../image/4.17.png)

#### 5.构建Ceph集群:

###### (1)在ceph-admin节点上安装ceph-deploy

![](../image/4.18.png)

###### (2)使用“ **ceph -deploy** ”命令创建一个新的集群配置，将监视节点定义为“ **mon1** ”

![](../image/4.19.png)

###### (3)编辑ceph.conf文件

![](../image/4.20.png)

###### (4) 在所有节点上安装Ceph

![](../image/4.21.png)

###### (5)将ceph-mon部署在mon1节点上

![](../image/4.22.png)

###### (6)创建监视键，并使用“ ceph”命令检查并获取键

![](../image/4.23.png)

###### (7)为osd守护目录创建进程并赋予权限

![](../image/4.24.png)

![](../image/4.25.png)

###### （8）将OSDS添加到集群

![](../image/4.26.png)

###### （9）激活OSD

![](../image/4.27.png)

###### （10）将管理密钥部署到所有关联的节点

![](../image/4.28.png)

###### （11）更改密钥文件的权限

![](../image/4.29.png)

#### 6.测试Ceph设置

###### （1）检查集群运行状况

![](../image/4.21.png)

###### （2）检查集群状态

![](../image/4.31.png)